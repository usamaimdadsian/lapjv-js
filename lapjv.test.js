import { lapjv } from './lapjv-js.js';

test('lapjv returns expected cost and assignments', async () => {
const costMatrix =
  [
    [0.6746464009519365, 0.6418324822498715, 0.7633592933709568, 0.7586174132044651, 0.8183108958536918, 0.6215615816651628, 0.8972220220962127, 0.9084898612258853, 0.9216982946136071, 0.926305648915321, 0.9258312181273325, 0.9245351385756075, 0.9488245403366329, 0.9464018623212397, 0.9627371729594391, 0.9648341639983414],
    [0.4923825992699644, 0.1516073290981783, 0.4235334505808577, 0.3778027298922686, 0.5406260206606304, 0.7523896588138246, 0.7267516370575247, 0.7823369713361605, 0.766162831096492, 0.7910679948440894, 0.7865592566833945, 0.7885426684342672, 0.8567708657872473, 0.8319855808986593, 0.883886086304162, 0.8990188012871139],
    [0.13414221911766588, 0.48639263019145385, 0.49417399292465225, 0.5833832330599845, 0.5254650464725541, 0.6016212822833853, 0.8448361799812628, 0.8827758158412042, 0.863316432038334, 0.8789403575232653, 0.8055040179173576, 0.7986689125541706, 0.9169608280570992, 0.8652232218851652, 0.9146007544828171, 0.9081879641409991],
    [0.5153108332489882, 0.7125637674219211, 0.7312623767890671, 0.7764455498458471, 0.7549300046211542, 0.2364426349552914, 0.9158162670226266, 0.9339536318225066, 0.9288992965264382, 0.9358571540060066, 0.9023653083828413, 0.8984630196709394, 0.9557587620877684, 0.9333087204331503, 0.9572880100860086, 0.9538320001045425],
    [0.48638545023221835, 0.4258391041147004, 0.1637282653963028, 0.30715474563146783, 0.32634386274947613, 0.7627020328395935, 0.7433611761682848, 0.8046533956640288, 0.7729040120146264, 0.7994957441677495, 0.6870623826543031, 0.6902952776879958, 0.8627761320146272, 0.7724861560494036, 0.8565906274542422, 0.8520660352156543],
    [0.5652682473950408, 0.36860639352593794, 0.3023445499833207, 0.18099491749082597, 0.3959916108860744, 0.7975600253651327, 0.6899090751399488, 0.7597883136181637, 0.7283755363443598, 0.7593528942554488, 0.7164693936556916, 0.7199738789170482, 0.8353209972321733, 0.7750073389721033, 0.8440876017767034, 0.865908404126003],
    [0.7932732783710118, 0.6486787934076441, 0.6677154210967093, 0.6084290231405569, 0.6896495570819293, 0.9077766887989884, 0.4548980327862665, 0.6504887298629607, 0.4298787516310165, 0.5377768525205653, 0.8083647133600697, 0.8188006515742903, 0.6844230912675963, 0.8243291036543844, 0.8778509421902593, 0.9094365682521417],
    [0.49512138353513924, 0.5188347893047429, 0.3053033171615699, 0.3898744729732283, 0.19826214059355374, 0.7738255509726161, 0.7540666069093385, 0.8184668923495264, 0.7787566611152821, 0.8057663683104463, 0.6670852922636641, 0.6549842333398013, 0.8671589703664876, 0.7701715920003693, 0.8556433885376811, 0.8430176908458595],
    [0.808448164964908, 0.6643398415664936, 0.6937305923176085, 0.635203374195243, 0.7188121545453646, 0.910377754171059, 0.3012742364350556, 0.5526594175934052, 0.5571197922580251, 0.5653125059328102, 0.8342228414294477, 0.8381717608687218, 0.7020563945195178, 0.8633452141434514, 0.9042567117215151, 0.9213351347984028],
    [0.7947940858152744, 0.647596433694721, 0.6713544964176877, 0.6111236573777884, 0.6950426488322767, 0.9063543193796086, 0.39874788829502883, 0.6157037233747661, 0.4833697957062272, 0.49407318680459844, 0.8120757017879277, 0.8223620396343232, 0.6571696360936872, 0.8403519109656221, 0.8883091921567448, 0.9111497975303876],
    [0.5871812153622156, 0.5565244969810857, 0.3604231839374783, 0.43237633952857746, 0.34649868305401266, 0.8203048187457469, 0.7142407885431448, 0.8210014737487752, 0.7348512225636417, 0.7675285404215092, 0.594953087446252, 0.6079979673448348, 0.8411315123207159, 0.719421961489945, 0.8243193287977115, 0.8073547794928702],
    [0.6470611885418005, 0.5676808970169067, 0.42408150726532623, 0.441263774275113, 0.4420943776622166, 0.8498076202914542, 0.7082325894616033, 0.8161682925732503, 0.6958392369092353, 0.7519878381428905, 0.6469736507965465, 0.6668798418153448, 0.8306557822974219, 0.6705679142778442, 0.7969654600416858, 0.8337536066963083],
    [0.8387940137115217, 0.6974592156554889, 0.7388987117502825, 0.6820508484014394, 0.7693794115423824, 0.9213939404955422, 0.5003225256585986, 0.41528658370050375, 0.6813838061433468, 0.6880798658420493, 0.8852092276410375, 0.8882675397274713, 0.7860388978176199, 0.9044152338675837, 0.9326111956496765, 0.9454227004657378]
  ];

const expected_cost = 3.9606618833643736;
const expected_x = [-1,  1,  0,  5,  2,  3,  8,  4,  6,  9, 11, 10,  7];
const expected_y = [ 2,  1,  4,  5,  7,  3,  8, 12,  6,  9, 11, 10, -1, -1, -1, -1];

  const { cost, x, y } = await lapjv(costMatrix, {
    extendCost: true,
    costLimit: 0.85,
  });

  expect(cost).toBeCloseTo(expected_cost, 5); // within 1e-5
  expect(x).toEqual(expected_x);
  expect(y).toEqual(expected_y);
});
